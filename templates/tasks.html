{% extends "base.html" %}

{% block title %}Tasks - Task Manager{% endblock %}

{% block content %}
<div class="tasks-page">
    <div class="tasks-header">
        <div>
            <h1>{% if show_archived %}Archived Tasks{% else %}My Tasks{% endif %}</h1>
            {% if archived_count > 0 and not show_archived %}
                <p class="archived-info">üì¶ {{ archived_count }} archived task{{ 's' if archived_count != 1 else '' }}</p>
            {% endif %}
        </div>
        <div class="header-actions">
            {% if show_archived %}
                <a href="{{ url_for('tasks') }}" class="btn btn-secondary">‚Üê Back to Active Tasks</a>
            {% else %}
                <button onclick="openCreateModal()" class="btn btn-primary">+ New Task</button>
                {% if archived_count > 0 %}
                    <a href="{{ url_for('tasks', archived='true') }}" class="btn btn-secondary">üì¶ View Archived ({{ archived_count }})</a>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" 
               id="searchInput" 
               placeholder="üîç Search tasks by title or description..." 
               class="search-input"
               onkeyup="searchTasks()">
        <button onclick="clearSearch()" class="search-clear" id="clearSearchBtn" style="display: none;">‚úï</button>
    </div>

    <!-- Filters -->
    <div class="filters">
        <div class="filter-group">
            <label>Status:</label>
            <select id="statusFilter" onchange="applyFilter('status', this.value)">
                <option value="">All</option>
                <option value="pending" {% if current_status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="in_progress" {% if current_status == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="completed" {% if current_status == 'completed' %}selected{% endif %}>Completed</option>
            </select>
        </div>

        <div class="filter-group">
            <label>Priority:</label>
            <select id="priorityFilter" onchange="applyFilter('priority', this.value)">
                <option value="">All</option>
                <option value="low" {% if current_priority == 'low' %}selected{% endif %}>Low</option>
                <option value="medium" {% if current_priority == 'medium' %}selected{% endif %}>Medium</option>
                <option value="high" {% if current_priority == 'high' %}selected{% endif %}>High</option>
            </select>
        </div>

        <div class="filter-group">
            <label>Category:</label>
            <select id="categoryFilter" onchange="applyFilter('category', this.value)">
                <option value="">All</option>
                {% for category in categories %}
                    <option value="{{ category }}" {% if current_category == category %}selected{% endif %}>{{ category }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Tasks List -->
    <div class="tasks-grid">
        {% if tasks %}
            {% for task in tasks %}
                <div class="task-card" data-task-id="{{ task.id }}">
                    <div class="task-card-header">
                        <h3>{{ task.title }}</h3>
                        <div class="task-actions">
                            {% if show_archived %}
                                <button onclick="unarchiveTask({{ task.id }})" class="btn-icon" title="Unarchive">üì§</button>
                            {% else %}
                                <button onclick="editTask({{ task.id }})" class="btn-icon" title="Edit">‚úèÔ∏è</button>
                                <button onclick="archiveTask({{ task.id }})" class="btn-icon" title="Archive">üì¶</button>
                            {% endif %}
                            <button onclick="deleteTask({{ task.id }})" class="btn-icon" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>

                    {% if task.description %}
                        <p class="task-card-description">{{ task.description }}</p>
                    {% endif %}

                    {% if task.notes %}
                        <div class="task-notes-preview">
                            <span class="notes-icon">üìù</span>
                            <span class="notes-text">{{ task.notes[:100] }}{% if task.notes|length > 100 %}...{% endif %}</span>
                        </div>
                    {% endif %}

                    <div class="task-card-meta">
                        <span class="badge badge-{{ task.status }}">{{ task.status.replace('_', ' ') }}</span>
                        <span class="badge badge-{{ task.priority }}">{{ task.priority }}</span>
                        {% if task.category %}
                            <span class="task-category">üìÅ {{ task.category }}</span>
                        {% endif %}
                    </div>

                    {% if task.due_date %}
                        <div class="task-card-date">
                            üìÖ Due: {{ task.due_date.strftime('%b %d, %Y') }}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state-large">
                <div class="empty-icon">üìù</div>
                <h3>No tasks found</h3>
                <p>Create your first task to get started!</p>
                <button onclick="openCreateModal()" class="btn btn-primary">Create Task</button>
            </div>
        {% endif %}
    </div>
</div>

<!-- Loading Indicator -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>
</div>

<!-- Create/Edit Task Modal -->
<div id="taskModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Create New Task</h2>
            <button onclick="closeModal()" class="modal-close">&times;</button>
        </div>

        <form id="taskForm" class="task-form">
            <input type="hidden" id="taskId">

            <div class="form-group">
                <label for="title">Title *</label>
                <input type="text" 
                       id="title" 
                       name="title" 
                       required 
                       minlength="3"
                       maxlength="200"
                       placeholder="Enter task title (min 3 characters)"
                       class="form-input">
                <span class="form-error" id="titleError"></span>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" 
                          name="description" 
                          rows="4" 
                          maxlength="1000"
                          placeholder="Enter task description (optional, max 1000 characters)"
                          class="form-input"></textarea>
                <span class="char-count" id="descCharCount">0 / 1000</span>
            </div>

            <div class="form-group">
                <label for="notes">Notes üìù</label>
                <textarea id="notes" 
                          name="notes" 
                          rows="3" 
                          maxlength="500"
                          placeholder="Add any additional notes or comments (optional, max 500 characters)"
                          class="form-input"></textarea>
                <span class="char-count" id="notesCharCount">0 / 500</span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="category">Category</label>
                    <input type="text" 
                           id="category" 
                           name="category" 
                           maxlength="50"
                           placeholder="e.g., Work, Personal"
                           class="form-input">
                </div>

                <div class="form-group">
                    <label for="priority">Priority *</label>
                    <select id="priority" name="priority" required class="form-input">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="status">Status *</label>
                    <select id="status" name="status" required class="form-input">
                        <option value="pending" selected>Pending</option>
                        <option value="in_progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="due_date">Due Date</label>
                    <input type="date" 
                           id="due_date" 
                           name="due_date"
                           class="form-input">
                    <span class="form-hint" id="dueDateHint"></span>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" onclick="closeModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary" id="submitBtn">
                    <span class="btn-text">Save Task</span>
                    <span class="btn-loading" style="display: none;">
                        <span class="mini-spinner"></span> Saving...
                    </span>
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Task management JavaScript
let editingTaskId = null;

// ============================================================================
// LOADING INDICATOR
// ============================================================================

function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

// ============================================================================
// MODAL FUNCTIONS
// ============================================================================

function openCreateModal() {
    editingTaskId = null;
    document.getElementById('modalTitle').textContent = 'Create New Task';
    document.getElementById('taskForm').reset();
    document.getElementById('taskId').value = '';
    clearFormErrors();
    updateCharCount();
    updateDueDateHint();
    document.getElementById('taskModal').style.display = 'flex';
    
    // Focus on title input
    setTimeout(() => {
        document.getElementById('title').focus();
    }, 100);
}

function closeModal() {
    document.getElementById('taskModal').style.display = 'none';
    editingTaskId = null;
    clearFormErrors();
}

// ============================================================================
// FORM VALIDATION
// ============================================================================

function clearFormErrors() {
    const errorElements = document.querySelectorAll('.form-error');
    errorElements.forEach(el => {
        el.textContent = '';
        el.style.display = 'none';
    });
    
    const inputElements = document.querySelectorAll('.form-input');
    inputElements.forEach(el => {
        el.classList.remove('input-error');
    });
}

function showFieldError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const errorElement = document.getElementById(fieldId + 'Error');
    
    if (field) {
        field.classList.add('input-error');
    }
    
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
}

function validateForm() {
    clearFormErrors();
    let isValid = true;
    
    // Validate title
    const title = document.getElementById('title').value.trim();
    if (title.length < 3) {
        showFieldError('title', 'Title must be at least 3 characters long');
        isValid = false;
    } else if (title.length > 200) {
        showFieldError('title', 'Title must not exceed 200 characters');
        isValid = false;
    }
    
    // Validate description length
    const description = document.getElementById('description').value;
    if (description.length > 1000) {
        showFieldError('description', 'Description must not exceed 1000 characters');
        isValid = false;
    }
    
    return isValid;
}

// ============================================================================
// CHARACTER COUNT & DATE HINTS
// ============================================================================

function updateCharCount() {
    const description = document.getElementById('description');
    const charCount = document.getElementById('descCharCount');
    
    if (description && charCount) {
        const count = description.value.length;
        charCount.textContent = `${count} / 1000`;
        
        if (count > 900) {
            charCount.style.color = 'var(--color-error)';
        } else if (count > 700) {
            charCount.style.color = 'var(--color-warning)';
        } else {
            charCount.style.color = 'var(--color-text-light)';
        }
    }
    
    // Update notes character count
    const notes = document.getElementById('notes');
    const notesCount = document.getElementById('notesCharCount');
    
    if (notes && notesCount) {
        const count = notes.value.length;
        notesCount.textContent = `${count} / 500`;
        
        if (count > 450) {
            notesCount.style.color = 'var(--color-error)';
        } else if (count > 350) {
            notesCount.style.color = 'var(--color-warning)';
        } else {
            notesCount.style.color = 'var(--color-text-light)';
        }
    }
}

function updateDueDateHint() {
    const dueDateInput = document.getElementById('due_date');
    const hintElement = document.getElementById('dueDateHint');
    
    if (!dueDateInput || !hintElement) return;
    
    const selectedDate = dueDateInput.value;
    if (!selectedDate) {
        hintElement.textContent = '';
        return;
    }
    
    const dueDate = new Date(selectedDate);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    dueDate.setHours(0, 0, 0, 0);
    
    const diffTime = dueDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays < 0) {
        hintElement.textContent = `‚ö†Ô∏è ${Math.abs(diffDays)} days overdue`;
        hintElement.style.color = 'var(--color-error)';
    } else if (diffDays === 0) {
        hintElement.textContent = '‚ö° Due today';
        hintElement.style.color = 'var(--color-warning)';
    } else if (diffDays === 1) {
        hintElement.textContent = 'üìÖ Due tomorrow';
        hintElement.style.color = 'var(--color-primary)';
    } else if (diffDays <= 7) {
        hintElement.textContent = `üìÖ Due in ${diffDays} days`;
        hintElement.style.color = 'var(--color-primary)';
    } else {
        hintElement.textContent = `üìÖ Due in ${diffDays} days`;
        hintElement.style.color = 'var(--color-text-light)';
    }
}

// Add event listeners for real-time updates
document.addEventListener('DOMContentLoaded', function() {
    const description = document.getElementById('description');
    const notes = document.getElementById('notes');
    const dueDate = document.getElementById('due_date');
    
    if (description) {
        description.addEventListener('input', updateCharCount);
    }
    
    if (notes) {
        notes.addEventListener('input', updateCharCount);
    }
    
    if (dueDate) {
        dueDate.addEventListener('change', updateDueDateHint);
    }
});

// ============================================================================
// FILTER FUNCTIONS
// ============================================================================

function applyFilter(type, value) {
    const url = new URL(window.location.href);
    if (value) {
        url.searchParams.set(type, value);
    } else {
        url.searchParams.delete(type);
    }
    window.location.href = url.toString();
}

// ============================================================================
// SEARCH FUNCTIONALITY
// ============================================================================

function searchTasks() {
    const searchInput = document.getElementById('searchInput');
    const searchTerm = searchInput.value.toLowerCase().trim();
    const taskCards = document.querySelectorAll('.task-card');
    const clearBtn = document.getElementById('clearSearchBtn');
    
    let visibleCount = 0;
    
    // Show/hide clear button
    if (searchTerm) {
        clearBtn.style.display = 'block';
    } else {
        clearBtn.style.display = 'none';
    }
    
    taskCards.forEach(card => {
        const title = card.querySelector('h3').textContent.toLowerCase();
        const descriptionElement = card.querySelector('.task-card-description');
        const description = descriptionElement ? descriptionElement.textContent.toLowerCase() : '';
        
        // Check if search term is in title or description
        if (title.includes(searchTerm) || description.includes(searchTerm)) {
            card.style.display = 'block';
            visibleCount++;
            
            // Highlight matching text
            if (searchTerm) {
                highlightText(card, searchTerm);
            } else {
                removeHighlight(card);
            }
        } else {
            card.style.display = 'none';
            removeHighlight(card);
        }
    });
    
    // Show/hide empty state
    updateEmptyState(visibleCount, searchTerm);
}

function highlightText(card, searchTerm) {
    const titleElement = card.querySelector('h3');
    const descriptionElement = card.querySelector('.task-card-description');
    
    // Highlight in title
    if (titleElement) {
        const originalTitle = titleElement.getAttribute('data-original-text') || titleElement.textContent;
        if (!titleElement.getAttribute('data-original-text')) {
            titleElement.setAttribute('data-original-text', originalTitle);
        }
        titleElement.innerHTML = highlightMatch(originalTitle, searchTerm);
    }
    
    // Highlight in description
    if (descriptionElement) {
        const originalDesc = descriptionElement.getAttribute('data-original-text') || descriptionElement.textContent;
        if (!descriptionElement.getAttribute('data-original-text')) {
            descriptionElement.setAttribute('data-original-text', originalDesc);
        }
        descriptionElement.innerHTML = highlightMatch(originalDesc, searchTerm);
    }
}

function highlightMatch(text, searchTerm) {
    const regex = new RegExp(`(${escapeRegex(searchTerm)})`, 'gi');
    return text.replace(regex, '<mark class="search-highlight">$1</mark>');
}

function removeHighlight(card) {
    const titleElement = card.querySelector('h3');
    const descriptionElement = card.querySelector('.task-card-description');
    
    if (titleElement && titleElement.getAttribute('data-original-text')) {
        titleElement.textContent = titleElement.getAttribute('data-original-text');
    }
    
    if (descriptionElement && descriptionElement.getAttribute('data-original-text')) {
        descriptionElement.textContent = descriptionElement.getAttribute('data-original-text');
    }
}

function escapeRegex(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function clearSearch() {
    const searchInput = document.getElementById('searchInput');
    searchInput.value = '';
    searchTasks();
    searchInput.focus();
}

function updateEmptyState(visibleCount, searchTerm) {
    const tasksGrid = document.querySelector('.tasks-grid');
    const existingEmptyState = tasksGrid.querySelector('.search-empty-state');
    
    // Remove existing empty state
    if (existingEmptyState) {
        existingEmptyState.remove();
    }
    
    // Show empty state if no results and search is active
    if (visibleCount === 0 && searchTerm) {
        const emptyState = document.createElement('div');
        emptyState.className = 'search-empty-state';
        emptyState.innerHTML = `
            <div class="empty-icon">üîç</div>
            <h3>No tasks found</h3>
            <p>No tasks match "${searchTerm}"</p>
            <button onclick="clearSearch()" class="btn btn-secondary">Clear Search</button>
        `;
        tasksGrid.appendChild(emptyState);
    }
}

// ============================================================================
// TASK EDITING & CRUD
// ============================================================================

async function archiveTask(taskId) {
    if (!confirm('Archive this task? You can unarchive it later.')) {
        return;
    }

    showLoading();

    try {
        const response = await fetch(`/api/tasks/${taskId}/archive`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ archived: true })
        });

        hideLoading();

        if (response.ok) {
            // Fade out and remove task card
            const card = document.querySelector(`[data-task-id="${taskId}"]`);
            card.style.animation = 'fadeOut 0.3s ease-out';
            
            setTimeout(() => {
                card.remove();
                showMessage('Task archived successfully üì¶', 'success');
                
                // Reload after delay to update archived count
                setTimeout(() => window.location.reload(), 1500);
            }, 300);
        } else {
            showMessage('Failed to archive task', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        hideLoading();
        showMessage('An error occurred', 'error');
    }
}

async function unarchiveTask(taskId) {
    showLoading();

    try {
        const response = await fetch(`/api/tasks/${taskId}/archive`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ archived: false })
        });

        hideLoading();

        if (response.ok) {
            // Fade out and remove task card
            const card = document.querySelector(`[data-task-id="${taskId}"]`);
            card.style.animation = 'fadeOut 0.3s ease-out';
            
            setTimeout(() => {
                card.remove();
                showMessage('Task unarchived successfully üì§', 'success');
                
                // Reload after delay to update view
                setTimeout(() => window.location.href = '/tasks', 1500);
            }, 300);
        } else {
            showMessage('Failed to unarchive task', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        hideLoading();
        showMessage('An error occurred', 'error');
    }
}

async function editTask(taskId) {
    showLoading();
    
    try {
        const response = await fetch(`/api/tasks/${taskId}`);
        
        if (!response.ok) {
            throw new Error('Failed to fetch task');
        }
        
        const data = await response.json();
        const task = data.task;
        
        // Set editing mode
        editingTaskId = taskId;
        
        // Update modal title
        document.getElementById('modalTitle').textContent = 'Edit Task';
        
        // Pre-fill form with task data
        document.getElementById('taskId').value = task.id;
        document.getElementById('title').value = task.title;
        document.getElementById('description').value = task.description || '';
        document.getElementById('notes').value = task.notes || '';
        document.getElementById('category').value = task.category || '';
        document.getElementById('priority').value = task.priority;
        document.getElementById('status').value = task.status;
        
        // Handle due date
        if (task.due_date) {
            const dueDate = new Date(task.due_date);
            const year = dueDate.getFullYear();
            const month = String(dueDate.getMonth() + 1).padStart(2, '0');
            const day = String(dueDate.getDate()).padStart(2, '0');
            document.getElementById('due_date').value = `${year}-${month}-${day}`;
        } else {
            document.getElementById('due_date').value = '';
        }
        
        // Update char count and date hint
        updateCharCount();
        updateDueDateHint();
        
        hideLoading();
        
        // Open modal
        document.getElementById('taskModal').style.display = 'flex';
        
    } catch (error) {
        console.error('Error fetching task:', error);
        hideLoading();
        showMessage('Failed to load task data', 'error');
    }
}

async function deleteTask(taskId) {
    if (!confirm('Are you sure you want to delete this task?')) {
        return;
    }

    showLoading();

    try {
        const response = await fetch(`/api/tasks/${taskId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        hideLoading();

        if (response.ok) {
            // Fade out and remove task card
            const card = document.querySelector(`[data-task-id="${taskId}"]`);
            card.style.animation = 'fadeOut 0.3s ease-out';
            
            setTimeout(() => {
                card.remove();
                showMessage('Task deleted successfully', 'success');
                
                // If no tasks left, reload to show empty state
                const tasksGrid = document.querySelector('.tasks-grid');
                if (tasksGrid.children.length === 0 || tasksGrid.querySelectorAll('.task-card').length === 0) {
                    setTimeout(() => window.location.reload(), 1000);
                }
            }, 300);
        } else {
            showMessage('Failed to delete task', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        hideLoading();
        showMessage('An error occurred', 'error');
    }
}

// Handle form submission
document.getElementById('taskForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    // Validate form
    if (!validateForm()) {
        return;
    }

    const formData = {
        title: document.getElementById('title').value.trim(),
        description: document.getElementById('description').value.trim(),
        notes: document.getElementById('notes').value.trim(),
        category: document.getElementById('category').value.trim(),
        priority: document.getElementById('priority').value,
        status: document.getElementById('status').value,
        due_date: document.getElementById('due_date').value || null
    };

    const taskId = document.getElementById('taskId').value;
    const url = taskId ? `/api/tasks/${taskId}` : '/api/tasks';
    const method = taskId ? 'PUT' : 'POST';

    // Show loading on button
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.querySelector('.btn-text').style.display = 'none';
    submitBtn.querySelector('.btn-loading').style.display = 'inline-flex';

    try {
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        if (response.ok) {
            showMessage(taskId ? 'Task updated successfully! ‚ú®' : 'Task created successfully! üéâ', 'success');
            closeModal();
            
            // Reload page after short delay
            setTimeout(() => {
                window.location.reload();
            }, 1200);
        } else {
            const error = await response.json();
            showMessage(error.error || 'Operation failed', 'error');
            
            // Reset button
            submitBtn.disabled = false;
            submitBtn.querySelector('.btn-text').style.display = 'inline';
            submitBtn.querySelector('.btn-loading').style.display = 'none';
        }
    } catch (error) {
        console.error('Error:', error);
        showMessage('An error occurred. Please try again.', 'error');
        
        // Reset button
        submitBtn.disabled = false;
        submitBtn.querySelector('.btn-text').style.display = 'inline';
        submitBtn.querySelector('.btn-loading').style.display = 'none';
    }
});

// ============================================================================
// NOTIFICATIONS
// ============================================================================

function showMessage(message, type) {
    const flashContainer = document.querySelector('.flash-container') || createFlashContainer();
    const flash = document.createElement('div');
    flash.className = `flash flash-${type}`;
    flash.style.animation = 'slideIn 0.3s ease-out';
    flash.innerHTML = `${message} <button onclick="this.parentElement.remove()" class="flash-close">&times;</button>`;
    flashContainer.appendChild(flash);

    setTimeout(() => {
        flash.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => flash.remove(), 300);
    }, 3500);
}

function createFlashContainer() {
    const container = document.createElement('div');
    container.className = 'flash-container';
    document.body.insertBefore(container, document.querySelector('.main-content'));
    return container;
}

// ============================================================================
// EVENT LISTENERS
// ============================================================================

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('taskModal');
    if (event.target === modal) {
        closeModal();
    }
}

// Keyboard shortcuts
document.addEventListener('keydown', function(event) {
    // Close modal on Escape
    if (event.key === 'Escape') {
        const modal = document.getElementById('taskModal');
        if (modal.style.display === 'flex') {
            closeModal();
        }
    }
    
    // Focus search on Ctrl+F or Cmd+F
    if ((event.ctrlKey || event.metaKey) && event.key === 'f') {
        event.preventDefault();
        document.getElementById('searchInput').focus();
    }
});
</script>
{% endblock %}
